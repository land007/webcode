services:
  webcode:
    image: land007/webcode:latest
    build: .
    container_name: webcode
    ports:
      - "20001:20001"  # Theia IDE (via Caddy)
      - "20002:20002"  # Vibe Kanban (via Caddy)
      - "20003:20003"  # OpenClaw (via Caddy)
      - "20004:20004"  # noVNC (via Caddy)
      - "20005:10005"  # TigerVNC (direct connection)
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - dna-data:/home/ubuntu/dna          # DNA 目录：项目源码，空时自动 clone
      - projects:/home/ubuntu/projects
      - vibe-kanban-data:/home/ubuntu/.local/share/vibe-kanban
      - theia-data:/home/ubuntu/.theia
      - user-data:/home/ubuntu/.local/share
      - gitconfig:/home/ubuntu/.gitconfig-vol
      - openclaw-data:/home/ubuntu/.openclaw
    environment:
      - MODE=${MODE:-desktop}
      - AUTH_USER=${AUTH_USER:-admin}
      - AUTH_PASSWORD=${AUTH_PASSWORD:-changeme}
      - OPENCLAW_TOKEN=${OPENCLAW_TOKEN:-changeme}
      - PASSWORD=${VNC_PASSWORD:-changeme}
      - VNC_RESOLUTION=${VNC_RESOLUTION:-1920x1080}
      - CF_TUNNEL_TOKEN=${CF_TUNNEL_TOKEN:-}
      - GIT_USER_NAME=${GIT_USER_NAME:-}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL:-}
      - DNA_REPO_URL=${DNA_REPO_URL:-https://github.com/land007/webcode}
    shm_size: "512m"
    security_opt:
      - seccomp=unconfined
    restart: unless-stopped

volumes:
  dna-data:
  projects:
  vibe-kanban-data:
  theia-data:
  user-data:
  openclaw-data:
  gitconfig:
